import { a, b as b$1 } from './chunk-ZFWGYZ2Z.js';
import { Buffer } from 'buffer';

var y=i=>{var e,t,a,c,u,r,s,o;return {baseURI:i.baseURI,debug:(e=i.debug)!=null?e:!1,loading:(t=i.loading)!=null?t:!0,loadingText:(a=i.loadingText)!=null?a:"\u4E0A\u4F20\u4E2D...",before:i.before,after:i.after,header:(c=i.header)!=null?c:{},timeout:(u=i.timeout)!=null?u:6e4,name:(r=i.name)!=null?r:"file",formData:(s=i.formData)!=null?s:{},saveSuffixName:(o=i.saveSuffixName)!=null?o:"png"}};var b=i=>{uni.showLoading({title:i.title,mask:i.mask||!0});};function O(i,e,t){return {request:s=>{var f;t.debug&&console.warn(`\u3010LwuUploader Debug:\u8BF7\u6C42\u62E6\u622A\u3011${JSON.stringify(t)}`),t.loading&&b({title:(f=t.loadingText)!=null?f:"\u4E0A\u4F20\u4E2D..."});let o="";process.env.NODE_ENV!=="development"?o=t.baseURI.dev:o=t.baseURI.pro;let d=a(a({},t),s),g=`${o}${s.url}`;return d.url=g,s.before&&s.before(d),i.request(d)},response:s=>(t.debug&&console.warn(`\u3010LwuUploader Debug:\u54CD\u5E94\u62E6\u622A\u3011${JSON.stringify(s)}`),e.after&&e.after(s),s),fail:s=>(t.debug&&console.warn(`\u3010LwuUploader Debug:\u8BF7\u6C42\u62E6\u622A\u5931\u8D25\u3011${JSON.stringify(s)}`),s),complete:s=>{uni.hideLoading(),t.debug&&console.warn(`\u3010LwuUploader Debug:\u8BF7\u6C42\u62E6\u622A\u5B8C\u6210\u3011${JSON.stringify(s)}`);}}}var C=i=>/\.(png|jpeg|jpg|webp|gif)$/i.test(i);var p=class{constructor(e,t){console.log(t,"\u8BF7\u6C42\u914D\u7F6E"),this.config=t,this.options=e,this.timeout=(e==null?void 0:e.timeout)||1,this.maxSize=(e==null?void 0:e.maxSize)||5*1024*1024,this.securityToken="",this.accessKeyId="",this.accessKeySecret="",this.uploadDir=(e==null?void 0:e.uploadDir)||"";let a$1="";a$1=(t==null?void 0:t.baseURI.pro)||"",process.env.NODE_ENV!=="development"&&(a$1=(t==null?void 0:t.baseURI.dev)||""),this.uploadImageUrl=(e==null?void 0:e.uploadImageUrl)||a$1,this.formData=a(a({},t==null?void 0:t.formData),e.formData),this.getOOSByAC=()=>e==null?void 0:e.getOOSByAC(),this.getPolicyBase64=()=>e.getPolicyBase64?e.getPolicyBase64():"";}getSignature(e,t,a){return b$1(this,null,function*(){return yield a==null?void 0:a.getSignature(e,t)})}getOOSByACInfo(){return b$1(this,null,function*(){let{accessKeyId:e,accessKeySecret:t,securityToken:a}=yield this.getOOSByAC();this.accessKeyId=e,this.accessKeySecret=t,this.securityToken=a;})}getDocs(){return b$1(this,null,function*(){return (yield import('./package-P4BT6CER.js')).homepage})}getPolicyBase64Res(){let e=new Date;e.setHours(e.getHours()+this.timeout);let a={expiration:e.toISOString(),conditions:[["content-length-range",0,this.maxSize*1024*1024]]};return Buffer.from(JSON.stringify(a)).toString("base64")}getUploadParams(){return b$1(this,null,function*(){let e=this.getPolicyBase64Res(),t=yield this.getSignature(e,this.accessKeySecret,this.options);return {OSSAccessKeyId:this.accessKeyId,policy:e,signature:t,"x-oss-security-token":this.securityToken}})}uploadFile(e,t,a$1,c){return new Promise((u,r)=>b$1(this,null,function*(){let s=`${yield this.getDocs()}/api/${c}.html#\u8BF7\u6C42\u53C2\u6570`;if(!e){r({code:1,msg:"\u6587\u4EF6\u8DEF\u5F84\u4E0D\u80FD\u4E3A\u7A7A",docs:s});return}let o=t||this.uploadDir;if(!o){r({code:1,msg:"\u4E0A\u4F20\u76EE\u5F55\u4E0D\u80FD\u4E3A\u7A7A\uFF0C\u8BF7\u68C0\u67E5 `uploadDir` \u53C2\u6570\u662F\u5426\u8BBE\u7F6E",docs:s});return}if(!this.uploadImageUrl){r({code:1,msg:"\u4E0A\u4F20\u670D\u52A1\u5668\u57DF\u540D\u6216\u4E0A\u4F20\u7684\u7B2C\u4E09\u65B9OOS\u5730\u5740\u4E0D\u80FD\u4E3A\u7A7A\uFF0C\u8BF7\u68C0\u67E5 `uploadImageUrl` \u53C2\u6570\u6216 `baseURI` \u5168\u5C40\u53C2\u6570\u662F\u5426\u8BBE\u7F6E ",docs:s});return}let d=C(e)?e.split(".").pop():a$1==null?void 0:a$1.saveSuffixName;if(!d){r({code:1,msg:"\u6587\u4EF6\u4FDD\u5B58\u540E\u7F00\u4E0D\u80FD\u4E3A\u7A7A\uFF0C\u8BF7\u68C0\u67E5 `saveSuffixName` \u53C2\u6570\u662F\u5426\u8BBE\u7F6E",docs:s});return}let g=`${Date.now()}_${Math.floor(Math.random()*1e6)}.${d}`;a$1!=null&&a$1.genarateFileName&&(g=yield a$1.genarateFileName());let f=`${this.uploadImageUrl}/${o}/${g}`,U=a(a({key:`${o}/${g}`,success_action_status:200},yield this.getUploadParams()),this.formData),x=uni.uploadFile({url:this.uploadImageUrl,filePath:e,name:"file",formData:a({},U),fail:m=>b$1(this,null,function*(){if(this.config&&this.config.debug&&console.warn(`\u3010LwuUpload Debug:\u7B2C\u4E09\u65B9oos\u8FD4\u56DE\u7ED3\u679C\u3011${JSON.stringify(m)}`),m.statusCode!==200){r({code:1,msg:"\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5",data:m.data,docs:yield this.getDocs()});return}})});u({code:0,msg:"success",data:{uploadTask:x,url:f,path:`/${o}/${g}`},docs:yield this.getDocs()});}))}},h=p;var S=class{constructor(e){this.globalConfig={baseURI:{pro:"",dev:""}};this.reqConfig={url:"",files:[],filePath:"",name:""};this.globalConfig=a({},y(e)),this.reqConfig=a({url:"",files:[],filePath:"",name:""},this.globalConfig);}config(e){return this.reqConfig=a(a({},this.reqConfig),e),this}setHeader(e){return this.reqConfig.header=a({},e),this}setFormData(e){return this.reqConfig.formData=a({},e),this}upload(e){let t=a(a({},this.reqConfig),e),a$1=O({request:r=>(e.url=r.url,r),response:r=>r},a({},t),this.globalConfig),c=a({},t.header),u=a({},t.formData);return a$1.request(t),uni.uploadFile({url:e.url,files:t.files,fileType:t.fileType,file:t.file,filePath:t.filePath,name:t.name,header:c,timeout:t.timeout,formData:u,success:r=>{a$1.response(r),e.success&&e.success(r);},fail:r=>{a$1.fail(r),e.fail&&e.fail(r);},complete:r=>{a$1.complete(r),e.complete&&e.complete(r);}})}uploadOOSSync(e){return b$1(this,null,function*(){let t=new h(e,a({baseURI:{pro:"",dev:""}},this.reqConfig));return yield t.getOOSByACInfo(),yield t.uploadFile(e.filePath,e.uploadDir,e,"uploadOOSSync")})}uploadOOS(e){let t=new h(e,a({baseURI:{pro:"",dev:""}},this.reqConfig));t.getOOSByACInfo().then(()=>t.uploadFile(e.filePath,e.uploadDir,e,"uploadOOS"));}};

export { S as Uploader };
